{% extends "base.html" %}

{% block title %}Dashboard - echo{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="py-6">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-8">Dashboard</h1>
        
        {% if current_user.is_seller %}
            <!-- Seller Dashboard -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-8">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Your Services</h2>
                {% if services %}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for service in services %}
                            <div class="bg-white dark:bg-gray-700 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
                                <div class="p-6">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">{{ service.title }}</h3>
                                    <p class="text-gray-600 dark:text-gray-300 mb-4">{{ service.description[:100] }}...</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-blue-600 dark:text-blue-400 font-semibold">${{ "%.2f"|format(service.price) }}</span>
                                        <a href="{{ url_for('service_detail', service_id=service.id) }}" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">View Details</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-600 dark:text-gray-300">You haven't created any services yet.</p>
                    <a href="#" class="inline-block mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-300">Create Your First Service</a>
                {% endif %}
            </div>
        {% else %}
            <!-- Buyer Dashboard -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">Welcome, {{ current_user.username }}!</h2>
                
                {% if bookmarked_services %}
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Your Saved Services</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {% for service in bookmarked_services %}
                                <div class="bg-white dark:bg-gray-700 rounded-lg shadow-md overflow-hidden">
                                    <div class="p-6">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100">{{ service.title }}</h4>
                                            <button class="bookmark-btn text-blue-500" data-service-id="{{ service.id }}">
                                                <i class="fas fa-bookmark"></i>
                                            </button>
                                        </div>
                                        <p class="text-gray-600 dark:text-gray-300 mb-4">{{ service.description[:100] }}...</p>
                                        <div class="flex justify-between items-center">
                                            <span class="text-blue-600 dark:text-blue-400 font-semibold">${{ "%.2f"|format(service.price) }}</span>
                                            <a href="{{ url_for('service_detail', service_id=service.id) }}" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">View Details</a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <p class="text-gray-600 dark:text-gray-300 mb-6">You haven't saved any services yet. Browse our services to find the perfect freelancer for your project.</p>
                {% endif %}
                
                <a href="{{ url_for('services') }}" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors duration-300">Browse Services</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Bookmark functionality
    document.querySelectorAll('.bookmark-btn').forEach(button => {
        button.addEventListener('click', async (e) => {
            e.preventDefault();
            const serviceId = button.dataset.serviceId;
            const icon = button.querySelector('i');
            
            try {
                const response = await fetch(`/bookmark/${serviceId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (!data.bookmarked) {
                        // Remove the service card from the dashboard
                        const serviceCard = button.closest('.grid > div');
                        if (serviceCard) {
                            serviceCard.remove();
                            
                            // If no more bookmarked services, show the empty state
                            const bookmarkedServices = document.querySelectorAll('.grid > div');
                            if (bookmarkedServices.length === 0) {
                                const container = document.querySelector('.mb-8');
                                container.innerHTML = `
                                    <p class="text-gray-600 dark:text-gray-300 mb-6">You haven't saved any services yet. Browse our services to find the perfect freelancer for your project.</p>
                                `;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error toggling bookmark:', error);
            }
        });
    });
</script>
{% endblock %} 